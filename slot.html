<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <title>Funny Face - Bet Control</title>
    <style>
        /* STYLY HRY */
        body { background: #1a1a1a; color: white; font-family: 'Segoe UI', sans-serif; text-align: center; padding: 20px; margin: 0; }
        .game-container { display: inline-block; background: #333; padding: 25px; border: 6px solid #b8860b; border-radius: 15px; box-shadow: 0 0 30px rgba(0,0,0,0.7); position: relative; margin-top: 50px; }
        .grid { display: flex; gap: 10px; background: #000; padding: 15px; border-radius: 8px; overflow: hidden; height: 275px; }
        .reel { display: flex; flex-direction: column; gap: 10px; width: 85px; will-change: transform; }
        @keyframes spinDown { 0% { transform: translateY(-380px); } 100% { transform: translateY(0); } }
        .spinning { animation: spinDown 0.1s linear infinite; filter: blur(2px); }
        .symbol { width: 85px; height: 85px; background: #fff; border-radius: 6px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; overflow: hidden; }
        .symbol img { width: 90%; height: 90%; object-fit: contain; }
        .symbol.win { background: #ffd700; border: 2px solid #ff4500; transform: scale(1.05); z-index: 10; box-shadow: 0 0 15px #ffd700; }
        .stats { margin: 20px 0; font-size: 18px; display: flex; justify-content: space-between; font-weight: bold; background: rgba(0,0,0,0.3); padding: 10px; border-radius: 8px; }
        #balance { color: #00ff00; }
        #status { height: 40px; font-size: 24px; color: gold; font-weight: bold; }
        .controls { display: flex; align-items: center; justify-content: center; gap: 15px; margin-top: 20px; flex-wrap: wrap; }
        .bet-selector { display: flex; align-items: center; background: #444; padding: 5px 15px; border-radius: 50px; border: 2px solid #b8860b; }
        .bet-btn { background: #b8860b; color: white; border: none; width: 35px; height: 35px; border-radius: 50%; font-size: 20px; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .bet-btn:hover:not(:disabled) { background: #daa520; }
        .bet-btn:disabled { background: #555; cursor: not-allowed; opacity: 0.5; }
        #current-bet { font-size: 22px; width: 80px; text-align: center; color: #fff; }
        .max-btn { background: #444; color: gold; border: 2px solid gold; padding: 8px 15px; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .max-btn:hover { background: gold; color: black; }
        .spin-btn { padding: 15px 50px; font-size: 24px; cursor: pointer; background: linear-gradient(#ff6347, #ff4500); color: white; border: none; border-radius: 50px; font-weight: bold; box-shadow: 0 5px 0 #8b0000; }
        .spin-btn:active { transform: translateY(3px); box-shadow: 0 2px 0 #8b0000; }
        .spin-btn:disabled { background: #555; box-shadow: none; cursor: not-allowed; opacity: 0.6; }
        
        .back-lobby { 
            position: absolute; 
            top: -50px; 
            left: 0; 
            color: black; 
            background: gold; 
            text-decoration: none; 
            font-weight: bold; 
            font-size: 16px; 
            padding: 8px 15px; 
            border-radius: 5px;
            box-shadow: 0 4px 0 #b8860b;
        }
        .back-lobby:hover { background: white; }
    </style>
</head>
<body>

<div class="game-container">
    <a href="index.html" class="back-lobby">⬅ ZPĚT DO CASINA</a>
    
    <h1>FUNNY FACE</h1>
    <div id="status">PŘIPRAVEN</div>
    <div class="grid" id="slot-grid"></div>
    <div class="stats">
        <div>KREDITY: <span id="balance">0.00</span></div>
        <div>POSLEDNÍ VÝHRA: <span id="last-win">0.00</span></div>
    </div>
    <div class="controls">
        <button class="max-btn" id="max-btn" onclick="setMaxBet()">MAX</button>
        <div class="bet-selector">
            <button class="bet-btn" onclick="changeBet(-1)" id="bet-minus">−</button>
            <div id="current-bet">10</div>
            <button class="bet-btn" onclick="changeBet(1)" id="bet-plus">+</button>
        </div>
        <button class="spin-btn" id="spin-btn" onclick="startSpin()">SPIN</button>
    </div>
</div>

<script>
// KONSTANTY SYMBOLŮ
const SYMS = { 1: "img/7.png", 2: "img/bell.png", 3: "img/melon.png", 4: "img/plum.png", 5: "img/orange.png", 6: "img/lemon.png", 7: "img/cherry.png", 8: "img/star.png", 9: "img/joker.png" };
const WILD = 9;
const LINE_PAY = { 
    1: [0, 0, 50, 150, 300], // Sedmičky (výrazně posíleny)
    2: [0, 0, 25, 75, 150],  // Zvony
    3: [0, 0, 25, 75, 150],  // Melouny
    4: [0, 0, 10, 25, 50],   // Švestky
    5: [0, 0, 10, 25, 50],   // Pomeranče
    6: [0, 0, 10, 25, 50],   // Citrony
    7: [0, 0, 10, 25, 50]    // Třešně
};
const BET_LINES = [[1,1,1,1,1],[0,0,0,0,0],[2,2,2,2,2],[0,1,2,1,0],[2,1,0,1,2],[0,0,1,2,2],[2,2,1,0,0],[1,0,1,2,1],[1,2,1,0,1],[1,0,0,0,1]];
const REELS_DATA = [[5,8,7,2,4,7,3,9,4,5,2,4,6,1,3,6,4,2,5,6,1,5,4,3,7,2,3,1,6,7,1,6,5,7,1],[5,6,4,5,6,1,4,3,6,2,4,1,7,9,4,3,7,2,6,7,3,2,5,6,7,5,1,4,8,2,7,5,1,3],[7,5,4,3,5,6,1,4,6,3,1,8,6,2,7,1,2,7,5,4,2,5,3,7,2,3,1,9,4,6],[4,5,2,1,3,7,1,4,6,2,1,7,4,5,2,9,6,3,7,5,1,6,4,3,7,4,5,6,3,2,6,8,5,7],[5,2,3,6,4,3,7,4,3,2,1,4,5,7,1,6,7,5,3,4,2,6,8,5,6,1,7,2,9,1,5,6,1,7,4]];

let balance = parseFloat(localStorage.getItem('casino_balance')) || 1000;
let currentBet = 10;
let screen = [[],[],[],[],[]];
let isSpinning = false;

function getSymHTML(id) { return `<img src="${SYMS[id]}" alt="${id}">`; }

function changeBet(direction) {
    if (isSpinning) return;
    let step = (currentBet >= 10 && (currentBet + direction * 10) >= 10) ? 10 : 1;
    let newBet = currentBet + (direction * step);
    if (newBet >= 1 && newBet <= 500) {
        currentBet = newBet;
        document.getElementById("current-bet").innerText = currentBet;
    }
}

function setMaxBet() {
    if (isSpinning) return;
    currentBet = 500;
    document.getElementById("current-bet").innerText = currentBet;
}

function init() {
    updateUI(0);
    const grid = document.getElementById("slot-grid");
    grid.innerHTML = "";
    for(let x=0; x<5; x++) {
        let reelDiv = document.createElement("div");
        reelDiv.className = "reel";
        reelDiv.id = `reel-${x}`;
        for(let y=0; y<8; y++) {
            let s = document.createElement("div");
            s.className = "symbol";
            s.id = `s_${x}_${y}`;
            s.innerHTML = getSymHTML(Math.floor(Math.random() * 7) + 1);
            reelDiv.appendChild(s);
        }
        grid.appendChild(reelDiv);
    }
}

async function startSpin() {
    if (isSpinning || balance < currentBet) {
        if (balance < currentBet) alert("Nedostatek kreditů!");
        return;
    }
    isSpinning = true;
    balance -= currentBet;
    toggleControls(true);
    document.getElementById("status").innerText = "TÁHNEŠ...";
    document.querySelectorAll('.symbol').forEach(s => s.classList.remove('win'));
    updateUI(0);

    for(let i=0; i<5; i++) {
        setTimeout(() => document.getElementById(`reel-${i}`).classList.add('spinning'), i * 60);
    }

    await new Promise(r => setTimeout(r, 1200));
    let totalWin = calculateWins();

    for(let i=0; i<5; i++) {
        await new Promise(r => setTimeout(r, 180));
        let reel = document.getElementById(`reel-${i}`);
        for(let y=0; y<3; y++) {
            document.getElementById(`s_${i}_${y}`).innerHTML = getSymHTML(screen[i][y]);
        }
        reel.classList.remove('spinning');
    }

    if(totalWin > 0) {
        balance += totalWin;
        document.getElementById("status").innerText = "VÝHRA!";
        highlightWins();
    } else {
        document.getElementById("status").innerText = "";
    }

    updateUI(totalWin);
    toggleControls(false);
    isSpinning = false;
}

function toggleControls(disabled) {
    document.getElementById("spin-btn").disabled = disabled;
    document.getElementById("bet-minus").disabled = disabled;
    document.getElementById("bet-plus").disabled = disabled;
    document.getElementById("max-btn").disabled = disabled;
}

function calculateWins() {
    for(let x=0; x<5; x++) {
        let tape = REELS_DATA[x];
        let stop = Math.floor(Math.random() * tape.length);
        for(let y=0; y<3; y++) screen[x][y] = tape[(stop + y) % tape.length];
    }
    let win = 0;
    let betPerLine = currentBet / 10; 
    BET_LINES.forEach(line => {
        let activeSym = screen[0][line[0]];
        if (activeSym === WILD) {
            for(let i=1; i<5; i++) { if(screen[i][line[i]] !== WILD) { activeSym = screen[i][line[i]]; break; } }
        }
        let matches = 1;
        for(let x=1; x<5; x++) {
            if (screen[x][line[x]] === activeSym || screen[x][line[x]] === WILD) matches++; else break;
        }
        let paySym = (activeSym === WILD) ? 1 : activeSym;
        if(LINE_PAY[paySym] && LINE_PAY[paySym][matches-1] > 0) { win += LINE_PAY[paySym][matches-1] * betPerLine; }
    });
    return win;
}

function highlightWins() {
    BET_LINES.forEach(line => {
        let activeSym = screen[0][line[0]];
        if (activeSym === WILD) {
            for(let i=1; i<5; i++) { if(screen[i][line[i]] !== WILD) { activeSym = screen[i][line[i]]; break; } }
        }
        let matches = 1;
        for(let x=1; x<5; x++) {
            if (screen[x][line[x]] === activeSym || screen[x][line[x]] === WILD) matches++; else break;
        }
        let paySym = (activeSym === WILD) ? 1 : activeSym;
        if(LINE_PAY[paySym] && LINE_PAY[paySym][matches-1] > 0) {
            for(let i=0; i<matches; i++) document.getElementById(`s_${i}_${line[i]}`).classList.add('win');
        }
    });
}

function updateUI(win) {
    document.getElementById("balance").innerText = balance.toFixed(2);
    document.getElementById("last-win").innerText = win.toFixed(2);
    localStorage.setItem('casino_balance', balance); 
}

init();
</script>
</body>
</html>